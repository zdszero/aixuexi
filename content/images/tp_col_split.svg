<svg viewBox="0 0 1000 800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .matrix-rect { stroke: #2c3e50; stroke-width: 2; }
      .device-rect { stroke: #3498db; stroke-width: 2; stroke-dasharray: 5,5; fill: none; }
      .text-label { font-family: Arial, sans-serif; font-size: 16px; fill: #2c3e50; }
      .text-small { font-family: Arial, sans-serif; font-size: 14px; fill: #555; }
      .text-math { font-family: 'Times New Roman', serif; font-size: 15px; font-style: italic; }
      .arrow { stroke: #e74c3c; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .gather-arrow { stroke: #27ae60; stroke-width: 2; fill: none; marker-end: url(#arrowhead-green); }
      .title-text { font-family: Arial, sans-serif; font-size: 20px; font-weight: bold; fill: #2c3e50; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#e74c3c" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#27ae60" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="500" y="30" text-anchor="middle" class="title-text">矩阵列拆分并行计算</text>
  
  <!-- Stage 1: Original Matrices -->
  <text x="50" y="70" class="text-label" font-weight="bold">步骤 1: 原始矩阵</text>
  
  <!-- Matrix A -->
  <rect x="80" y="90" width="80" height="120" fill="#e8f4f8" class="matrix-rect"/>
  <text x="120" y="155" text-anchor="middle" class="text-label">A</text>
  <text x="120" y="225" text-anchor="middle" class="text-small">L × K</text>
  
  <!-- Multiplication sign -->
  <text x="175" y="155" text-anchor="middle" class="text-label" font-size="24">×</text>
  
  <!-- Matrix B (complete) -->
  <rect x="210" y="90" width="240" height="120" fill="#fff4e6" class="matrix-rect"/>
  <text x="330" y="155" text-anchor="middle" class="text-label">B</text>
  <text x="330" y="225" text-anchor="middle" class="text-small">K × M</text>
  
  <!-- Equal sign -->
  <text x="470" y="155" text-anchor="middle" class="text-label" font-size="24">=</text>
  
  <!-- Matrix C (result) -->
  <rect x="505" y="90" width="240" height="120" fill="#e8f5e9" class="matrix-rect"/>
  <text x="625" y="155" text-anchor="middle" class="text-label">C</text>
  <text x="625" y="225" text-anchor="middle" class="text-small">L × M</text>
  
  <!-- Stage 2: Split B into columns -->
  <text x="50" y="270" class="text-label" font-weight="bold">步骤 2: 拆分矩阵 B (沿列切分)</text>
  
  <!-- Matrix A (replicated) -->
  <rect x="80" y="310" width="80" height="120" fill="#e8f4f8" class="matrix-rect"/>
  <text x="120" y="375" text-anchor="middle" class="text-label">A</text>
  <text x="120" y="445" text-anchor="middle" class="text-small">L × K</text>
  <text x="120" y="460" text-anchor="middle" class="text-small" fill="#e74c3c">(复制到所有设备)</text>
  
  <!-- Multiplication sign -->
  <text x="175" y="375" text-anchor="middle" class="text-label" font-size="24">×</text>
  
  <!-- Matrix B split into N parts -->
  <g id="b-splits">
    <!-- B0 -->
    <rect x="210" y="310" width="55" height="120" fill="#ffebcc" class="matrix-rect"/>
    <text x="237.5" y="365" text-anchor="middle" class="text-label">B₀</text>
    <text x="237.5" y="445" text-anchor="middle" class="text-small">K × M/N</text>
    <text x="237.5" y="300" text-anchor="middle" class="text-small" fill="#3498db">设备 0</text>
    
    <!-- B1 -->
    <rect x="270" y="310" width="55" height="120" fill="#ffe0b3" class="matrix-rect"/>
    <text x="297.5" y="365" text-anchor="middle" class="text-label">B₁</text>
    <text x="297.5" y="445" text-anchor="middle" class="text-small">K × M/N</text>
    <text x="297.5" y="300" text-anchor="middle" class="text-small" fill="#3498db">设备 1</text>
    
    <!-- Dots -->
    <text x="340" y="375" text-anchor="middle" class="text-label" font-size="24">···</text>
    
    <!-- BN-1 -->
    <rect x="370" y="310" width="55" height="120" fill="#ffd699" class="matrix-rect"/>
    <text x="397.5" y="365" text-anchor="middle" class="text-label">Bₙ₋₁</text>
    <text x="397.5" y="445" text-anchor="middle" class="text-small">K × M/N</text>
    <text x="397.5" y="300" text-anchor="middle" class="text-small" fill="#3498db">设备 N-1</text>
  </g>
  
  <!-- Bracket notation -->
  <text x="200" y="375" text-anchor="middle" class="text-label" font-size="28">[</text>
  <text x="435" y="375" text-anchor="middle" class="text-label" font-size="28">]</text>
  
  <!-- Stage 3: Parallel computation -->
  <text x="50" y="510" class="text-label" font-weight="bold">步骤 3: 并行计算 (每个设备独立计算)</text>
  
  <!-- Device boxes with computation -->
  <g id="device-0">
    <rect x="70" y="530" width="180" height="100" class="device-rect"/>
    <text x="160" y="555" text-anchor="middle" class="text-small" fill="#3498db" font-weight="bold">设备 0</text>
    <text x="160" y="580" text-anchor="middle" class="text-math">C₀ = A × B₀</text>
    <text x="160" y="605" text-anchor="middle" class="text-small">结果维度: L × M/N</text>
  </g>
  
  <g id="device-1">
    <rect x="270" y="530" width="180" height="100" class="device-rect"/>
    <text x="360" y="555" text-anchor="middle" class="text-small" fill="#3498db" font-weight="bold">设备 1</text>
    <text x="360" y="580" text-anchor="middle" class="text-math">C₁ = A × B₁</text>
    <text x="360" y="605" text-anchor="middle" class="text-small">结果维度: L × M/N</text>
  </g>
  
  <text x="490" y="580" text-anchor="middle" class="text-label" font-size="24">···</text>
  
  <g id="device-n">
    <rect x="540" y="530" width="180" height="100" class="device-rect"/>
    <text x="630" y="555" text-anchor="middle" class="text-small" fill="#3498db" font-weight="bold">设备 N-1</text>
    <text x="630" y="580" text-anchor="middle" class="text-math">Cₙ₋₁ = A × Bₙ₋₁</text>
    <text x="630" y="605" text-anchor="middle" class="text-small">结果维度: L × M/N</text>
  </g>
  
  <!-- Stage 4: All-Gather -->
  <text x="50" y="670" class="text-label" font-weight="bold">步骤 4: All-Gather 聚合结果</text>
  
  <!-- Gather arrows -->
  <path d="M 160 630 L 160 680 L 330 680" class="gather-arrow"/>
  <path d="M 360 630 L 360 680 L 330 680" class="gather-arrow"/>
  <path d="M 630 630 L 630 680 L 350 680" class="gather-arrow"/>
  
  <!-- Final result C -->
  <rect x="210" y="690" width="240" height="80" fill="#e8f5e9" class="matrix-rect"/>
  <text x="330" y="720" text-anchor="middle" class="text-label" font-size="18">C = [C₀, C₁, ···, Cₙ₋₁]</text>
  <text x="330" y="750" text-anchor="middle" class="text-small">最终结果维度: L × M</text>
  
  <!-- Annotations -->
  <g id="annotations">
    <rect x="760" y="90" width="220" height="200" fill="#f9f9f9" stroke="#bbb" stroke-width="1" rx="5"/>
    <text x="870" y="115" text-anchor="middle" class="text-label" font-weight="bold">关键特点</text>
    <text x="770" y="145" class="text-small">• 输入 A 完整复制到所有设备</text>
    <text x="770" y="170" class="text-small">• 权重 B 按列切分为 N 份</text>
    <text x="770" y="195" class="text-small">• 各设备独立并行计算</text>
    <text x="770" y="220" class="text-small">• 通过 All-Gather 拼接结果</text>
    <text x="770" y="245" class="text-small">• 适合输出维度 M 很大的场景</text>
    <text x="770" y="270" class="text-small">• 通信量: O(L × M)</text>
  </g>
  
  <g id="math-notation">
    <rect x="760" y="310" width="220" height="140" fill="#fff8f0" stroke="#bbb" stroke-width="1" rx="5"/>
    <text x="870" y="335" text-anchor="middle" class="text-label" font-weight="bold">维度说明</text>
    <text x="770" y="365" class="text-small">L: 批次大小或序列长度</text>
    <text x="770" y="390" class="text-small">K: 输入特征维度</text>
    <text x="770" y="415" class="text-small">M: 输出特征维度(大)</text>
    <text x="770" y="440" class="text-small">N: 并行设备数量</text>
  </g>
</svg>
