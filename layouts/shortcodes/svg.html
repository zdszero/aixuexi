<!-- layouts/shortcodes/svg.html -->
{{/* layouts/shortcodes/svg.html */}}
{{ $svgFile := "" }}
{{ $widthArg := "" }}
{{ $nameArg := "" }}

{{/* Ensure that at least the SVG file path is provided */}}
{{ if ge (len .Params) 1 }}
  {{ $svgFile = .Get 0 }}
{{ else }}
  {{ errorf "The 'svg' shortcode requires at least one argument: the path to the SVG file. Usage: {{< svg \"path/to/file.svg\" [\"width\"] [\"caption\"] >}}" }}
  {{ return }}
{{ end }}

{{ if ge (len .Params) 2 }}
  {{ $widthArg = .Get 1 }}
{{ end }}

{{ if ge (len .Params) 3 }}
  {{ $nameArg = .Get 2 }}
{{ end }}

<div class="svg-wrapper" {{/* A wrapper to group SVG and its caption */}}>
  <div class="svg-container" {{ if and $widthArg (ne $widthArg "") }} style="height: auto; width: {{ $widthArg | safeCSS }};" {{ else }} style="height: auto;" {{/* If no widthArg, container takes auto width; SVG inside uses its CSS width (e.g., 80%) */}} {{ end }}>
    {{- with $svgFile -}}
      {{- $svgContent := readFile . -}}
      {{- if $svgContent -}}
        {{ $svgContent | safeHTML }}
      {{- else -}}
        {{ errorf "SVG file not found or unreadable: %s" . }}
      {{- end -}}
    {{- end -}}
  </div>

  {{ if and $nameArg (ne $nameArg "") }}
    <div class="svg-caption" style="text-align: center; margin-top: 0.5em; font-size: 0.8em; font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">
      {{ $nameArg | markdownify | safeHTML }}
    </div>
  {{ end }}
</div>
